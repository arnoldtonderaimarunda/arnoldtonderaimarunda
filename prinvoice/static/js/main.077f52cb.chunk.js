(this.webpackJsonpprinvoice=this.webpackJsonpprinvoice||[]).push([[0],{204:function(e,t,n){},258:function(e,t,n){},285:function(e,t,n){e.exports=n(570)},386:function(e,t,n){},388:function(e,t,n){},389:function(e,t,n){},392:function(e,t){},394:function(e,t){},432:function(e,t){},433:function(e,t){},567:function(e,t,n){},568:function(e,t,n){},569:function(e,t,n){},570:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(259),c=n.n(i),o=n(38),s=n.n(o),l=n(85),u=(n(386),n(25)),d=n(9),m=n.n(d),p=n(14),v=n(26),E=n(32),h=n(27),f=n(30),g=n(63),b=n(34),w=n(260),N=(n(388),function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).handleInputChange=function(e){a.state.error&&a.setState({error:void 0});var t=e.target,n=t.value,r=t.name;a.setState(Object(g.a)({},r,n))},a.handleSubmitForm=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,i,c,o,s,l,u;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.mode,i=n.handleSignIn,c=a.state,o=c.username,s=c.password,l=c.loading,t.preventDefault(),!l){e.next=5;break}return e.abrupt("return");case 5:return a.setState({loading:!0,error:void 0}),e.prev=6,e.next=9,"sign-up"===r?window.userbase.signUp({username:o,password:s,rememberMe:"local",email:o}):window.userbase.signIn({username:o,password:s,rememberMe:"local"});case 9:return u=e.sent,e.next=12,i(u);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(6),a.setState({error:e.t0.message,loading:!1});case 17:case"end":return e.stop()}}),e,null,[[6,14]])})));return function(t){return e.apply(this,arguments)}}(),a.handleForgotPassword=Object(p.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,n=t.username,!t.loading){e.next=3;break}return e.abrupt("return");case 3:return a.setState({loading:!0}),e.prev=4,e.next=7,window.userbase.forgotPassword({username:n});case 7:window.alert("Check your email!"),a.setState({loading:!1}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),a.setState({error:e.t0.message,loading:!1});case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),a.state={username:a.props.lastUsedUsername,password:"",error:void 0,loading:!1},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.state,t=e.username,n=e.password,a=e.error,i=e.loading,c=this.props.mode,o=!t||!n;return r.a.createElement("div",null,r.a.createElement("div",{className:"UserFormTitle"},r.a.createElement("h1",{style:{marginBottom:"20px"}},"Prinvoice"),r.a.createElement("h3",{style:{margin:"0"}},"Secure, private, beautiful invoices.")),r.a.createElement("div",{className:"OuterUserForm"},r.a.createElement("div",{className:"container UserForm"},r.a.createElement("form",{onSubmit:this.handleSubmitForm},r.a.createElement("div",{style:{marginTop:"1em"}},r.a.createElement("input",{className:"text-input",type:"email",name:"username",autoComplete:"username",onChange:this.handleInputChange,defaultValue:t,placeholder:"Email"})),r.a.createElement("div",{style:{marginTop:"1em"}},r.a.createElement("input",{className:"text-input",type:"password",name:"password",autoComplete:"new-password",onChange:this.handleInputChange,placeholder:"Password"})),"sign-up"===c&&r.a.createElement("div",{style:{marginTop:"1em"}},r.a.createElement("div",{className:"UserFormPasswordWarning"},r.a.createElement("p",{style:{textAlign:"justify"}},r.a.createElement(b.a,{icon:w.faInfoCircle,style:{marginRight:".5em",color:"#66bbae"}}),"Save your password in a safe place, such as a ",r.a.createElement("a",{href:"https://bitwarden.com/products/",target:"_blank",rel:"noopener noreferrer"},"password manager"),". You are the only person in the world who can access your invoices. If you forget your password and lose your device, no one in the world can recover your invoices."))),r.a.createElement("div",{style:{marginTop:"1em"}},r.a.createElement("input",{className:"button",type:"submit",value:"sign-up"===c?"Sign Up":"Sign In",disabled:o})),r.a.createElement("div",{style:{marginTop:"1em",minHeight:"1em",lineHeight:"1em"}},i&&r.a.createElement("div",{style:{paddingTop:".35rem"}},r.a.createElement("div",{className:"loader"})),a&&r.a.createElement("div",{className:"error"},a)),"sign-in"===c&&r.a.createElement("div",{style:{marginTop:"1em"}},r.a.createElement("p",{style:{width:"fit-content",margin:"auto",cursor:"pointer"},onClick:this.handleForgotPassword},"Forgot password?")),r.a.createElement("div",{style:{marginTop:"1em"}},"sign-up"===c?r.a.createElement("div",null,"Already have an account? ",r.a.createElement("a",{href:"#sign-in"},"Sign in")):r.a.createElement("div",null,"Or, ",r.a.createElement("a",{href:"#sign-up"},"create an account")))))))}}]),n}(a.Component)),y=n(262),O=n(261),S=n(265),D=n(266),C=n(267),x=n(263),R=n(264),T=(n(389),function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).handleClickOutside=function(e){a.state.menuOpen&&a.menuWrapperRef&&!a.menuWrapperRef.current.contains(e.target)&&a.setState({menuOpen:!1})},a.handleToggleMenu=function(){a.setState((function(e){return{menuOpen:!e.menuOpen}}))},a.handleSignOut=Object(p.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props.user&&a.props.user.username,!window.confirm("Are you sure you want to sign out?")){e.next=10;break}return e.prev=2,e.next=5,window.userbase.signOut();case 5:a.props.handleResetState(t),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,null,[[2,8]])}))),a.state={menuOpen:!1},a.menuWrapperRef=r.a.createRef(),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"render",value:function(){var e=this.props,t=e.mode,n=e.user,a=this.state.menuOpen;return r.a.createElement("div",{className:"topnav-container fixed"},r.a.createElement("ul",{className:"topnav max-screen-width"},r.a.createElement("li",{className:"dropdown"+(a?" active":""),ref:this.menuWrapperRef,id:"topnav-dropdown-menu"},r.a.createElement("div",{className:"dropbtn",onClick:this.handleToggleMenu},r.a.createElement(b.a,{icon:O.faBars})),r.a.createElement("div",{className:"dropdown-content"},r.a.createElement("div",{className:"dropdown-item",onClick:function(){return window.location.href="#account"}},r.a.createElement("div",{style:{textDecoration:"underline"}},n.username,r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:y.faUser})))),r.a.createElement("div",{className:"dropdown-divider"}),r.a.createElement("div",{className:"dropdown-item",onClick:this.props.handleDownloadData},"Download all of your data",r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:x.faDownload}))),r.a.createElement("div",{className:"dropdown-item",onClick:this.props.handleImportData},"Restore your data from download",r.a.createElement("span",{style:{marginLeft:"2em"},className:"float-right"},r.a.createElement(b.a,{icon:R.faUpload}))),r.a.createElement("div",{className:"dropdown-divider"}),r.a.createElement("div",{className:"dropdown-item",onClick:function(){return window.location.href="mailto:support@prinvoice.com"}},"Contact support@prinvoice.com"),r.a.createElement("div",{className:"dropdown-divider"}),r.a.createElement("div",{className:"dropdown-item dangerous-hover",onClick:this.handleSignOut},"Sign out"))),r.a.createElement("li",{className:"desktop-topnav-item"},r.a.createElement("a",{className:"topnav-item"+("dashboard"===t?" active":""),href:"#dashboard"},"DASHBOARD")),r.a.createElement("li",{className:"desktop-topnav-item"},r.a.createElement("a",{className:"topnav-item"+("invoices"===t?" active":""),href:"#invoices"},"INVOICES")),r.a.createElement("li",{className:"desktop-topnav-item"},r.a.createElement("a",{className:"topnav-item"+("customers"===t?" active":""),href:"#customers"},"CUSTOMERS")),r.a.createElement("li",{className:"mobile-nav-bar-items"},r.a.createElement("button",{className:"mobile-nav-bar-item "+("dashboard"===t?" active":""),onClick:function(){return window.location.href="#dashboard"}},r.a.createElement(b.a,{icon:S.faChartLine})),r.a.createElement("button",{className:"mobile-nav-bar-item "+("invoices"===t?" active":""),onClick:function(){return window.location.href="#invoices"}},r.a.createElement(b.a,{icon:D.faFileAlt})),r.a.createElement("button",{className:"mobile-nav-bar-item "+("customers"===t?" active":""),onClick:function(){return window.location.href="#customers"}},r.a.createElement(b.a,{icon:C.faUsers}))),r.a.createElement("li",{id:"new-invoice-button-wrapper",className:"right"},r.a.createElement("button",{className:"button-inverted nav-button left-button-with-icon",onClick:function(){return window.location.href="#new-invoice"}},"NEW INVOICE"),r.a.createElement("button",{className:"button-inverted nav-button right-button-with-icon",onClick:function(){return window.location.href="#new-invoice"}},r.a.createElement("svg",{className:"button-icon",width:"98",height:"116",viewBox:"0 0 98 116",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("rect",{width:"96.875",height:"115.625",transform:"translate(0.75 0.125)",fill:"#32363c"}),r.a.createElement("rect",{x:"8.5625",y:"14.1875",width:"71.875",height:"93.75",stroke:"#C6C386",strokeWidth:"3.125"}),r.a.createElement("rect",{x:"63.25",y:"6.375",width:"25",height:"25",fill:"#32363c"}),r.a.createElement("line",{x1:"69.5",y1:"14.1653",x2:"91.375",y2:"14.1653",stroke:"#C3EEE7",strokeWidth:"3.16933"}),r.a.createElement("path",{d:"M54.3041 69.2584C54.3041 71.3875 53.6479 73.1521 52.3354 74.5521C51.0229 75.9521 49.1854 76.8271 46.8229 77.1771C46.7062 77.1771 46.6479 77.2355 46.6479 77.3521L46.6916 80.5896C46.6916 80.8813 46.5458 81.0271 46.2541 81.0271H44.3291C44.0375 81.0271 43.8916 80.8813 43.8916 80.5896L43.9354 77.4834C43.9354 77.3667 43.877 77.3084 43.7604 77.3084C40.902 77.1625 38.6562 76.3605 37.0229 74.9021C35.3895 73.4146 34.5729 71.4896 34.5729 69.1271V67.7709C34.5729 67.4792 34.7187 67.3334 35.0104 67.3334H36.9791C37.2708 67.3334 37.4166 67.4792 37.4166 67.7709V68.9521C37.4166 70.6438 38.0729 72.0146 39.3854 73.0646C40.727 74.0855 42.5645 74.5959 44.8979 74.5959C46.9979 74.5959 48.602 74.1292 49.7104 73.1959C50.8187 72.2334 51.3729 70.9646 51.3729 69.3896C51.3729 68.3688 51.1104 67.4938 50.5854 66.7646C50.0895 66.0355 49.3166 65.35 48.2666 64.7084C47.2166 64.0667 45.7145 63.323 43.7604 62.4771C41.6604 61.6021 40.0416 60.8438 38.9041 60.2021C37.7958 59.5313 36.877 58.6855 36.1479 57.6646C35.4479 56.6146 35.0979 55.3021 35.0979 53.7271C35.0979 51.3646 35.8416 49.5125 37.3291 48.1709C38.8458 46.8 40.9312 46.0709 43.5854 45.9834C43.702 45.9834 43.7604 45.925 43.7604 45.8084L43.7166 42.4396C43.7166 42.148 43.8625 42.0021 44.1541 42.0021H46.0354C46.327 42.0021 46.4729 42.148 46.4729 42.4396L46.4291 45.9834C46.4291 46.1 46.4875 46.173 46.6041 46.2021C48.9375 46.5813 50.7604 47.4855 52.0729 48.9146C53.4145 50.3438 54.0854 52.1375 54.0854 54.2959V55.2584C54.0854 55.55 53.9395 55.6959 53.6479 55.6959H51.5916C51.3 55.6959 51.1541 55.55 51.1541 55.2584V54.4709C51.1541 52.7792 50.527 51.3938 49.2729 50.3146C48.0187 49.2355 46.2833 48.6959 44.0666 48.6959C42.1125 48.6959 40.6104 49.1188 39.5604 49.9646C38.5104 50.8105 37.9854 52.0355 37.9854 53.6396C37.9854 54.6896 38.2333 55.5646 38.7291 56.2646C39.2541 56.9355 39.9833 57.5334 40.9166 58.0584C41.8791 58.5542 43.352 59.2105 45.3354 60.0271C47.3479 60.9021 48.9666 61.7188 50.1916 62.4771C51.4458 63.2355 52.4375 64.1688 53.1666 65.2771C53.925 66.3563 54.3041 67.6834 54.3041 69.2584Z",fill:"#C3EEE7"}),r.a.createElement("path",{d:"M80.4374 25.1251V3.25014",stroke:"#C3EEE7",strokeWidth:"3.125"}))))))}}]),n}(a.Component)),_=n(571),k=n(281),L=n(102),I=n(103),A=(n(204),n(104)),U=n(283),M=n(7),P=n(280),$={AED:"\u062f.\u0625",AFN:"\u060b",ALL:"L",AMD:"\u058f",ANG:"\u0192",AOA:"Kz",ARS:"$",AUD:"$",AWG:"\u0192",AZN:"\u20bc",BAM:"KM",BBD:"$",BDT:"\u09f3",BGN:"\u043b\u0432",BHD:".\u062f.\u0628",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTC:"\u0e3f",BTN:"Nu.",BWP:"P",BYR:"Br",BYN:"Br",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLP:"$",CNY:"\xa5",COP:"$",CRC:"\u20a1",CUC:"$",CUP:"\u20b1",CVE:"$",CZK:"K\u010d",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"\u062f\u062c",EEK:"kr",EGP:"\xa3",ERN:"Nfk",ETB:"Br",ETH:"\u039e",EUR:"\u20ac",FJD:"$",FKP:"\xa3",GBP:"\xa3",GEL:"\u20be",GGP:"\xa3",GHC:"\u20b5",GHS:"GH\u20b5",GIP:"\xa3",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"\u20aa",IMP:"\xa3",INR:"\u20b9",IQD:"\u0639.\u062f",IRR:"\ufdfc",ISK:"kr",JEP:"\xa3",JMD:"J$",JOD:"JD",JPY:"\xa5",KES:"KSh",KGS:"\u043b\u0432",KHR:"\u17db",KMF:"CF",KPW:"\u20a9",KRW:"\u20a9",KWD:"KD",KYD:"$",KZT:"\u043b\u0432",LAK:"\u20ad",LBP:"\xa3",LKR:"\u20a8",LRD:"$",LSL:"M",LTC:"\u0141",LTL:"Lt",LVL:"Ls",LYD:"LD",MAD:"MAD",MDL:"lei",MGA:"Ar",MKD:"\u0434\u0435\u043d",MMK:"K",MNT:"\u20ae",MOP:"MOP$",MRO:"UM",MRU:"UM",MUR:"\u20a8",MVR:"Rf",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"\u20a6",NIO:"C$",NOK:"kr",NPR:"\u20a8",NZD:"$",OMR:"\ufdfc",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"\u20b1",PKR:"\u20a8",PLN:"z\u0142",PYG:"Gs",QAR:"\ufdfc",RMB:"\uffe5",RON:"lei",RSD:"\u0414\u0438\u043d.",RUB:"\u20bd",RWF:"R\u20a3",SAR:"\ufdfc",SBD:"$",SCR:"\u20a8",SDG:"\u062c.\u0633.",SEK:"kr",SGD:"$",SHP:"\xa3",SLL:"Le",SOS:"S",SRD:"$",SSP:"\xa3",STD:"Db",STN:"Db",SVC:"$",SYP:"\xa3",SZL:"E",THB:"\u0e3f",TJS:"SM",TMT:"T",TND:"\u062f.\u062a",TOP:"T$",TRL:"\u20a4",TRY:"\u20ba",TTD:"TT$",TVD:"$",TWD:"NT$",TZS:"TSh",UAH:"\u20b4",UGX:"USh",USD:"$",UYU:"$U",UZS:"\u043b\u0432",VEF:"Bs",VND:"\u20ab",VUV:"VT",WST:"WS$",XAF:"FCFA",XBT:"\u0243",XCD:"$",XOF:"CFA",XPF:"\u20a3",YER:"\ufdfc",ZAR:"R",ZWD:"Z$"},F=function(e){return new Date(e).toLocaleDateString("fr-CA",{year:"numeric",month:"2-digit",day:"2-digit"})},j="^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$",B=function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n},H=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Number(e.toFixed(2)).toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:t})},q=function(e){return e instanceof Date&&!isNaN(e)},W=function(e,t){if(!t)return e;for(var n=[],a=e;a.length>0;){var i=a.toLowerCase().indexOf(t.toLowerCase());-1!==i?(n.push(r.a.createElement("span",{key:Math.random()},a.substring(0,i))),n.push(r.a.createElement("span",{className:"bold",key:Math.random()},a.substring(i,i+t.length))),a=a.substring(i+t.length,a.length)):(n.push(r.a.createElement("span",{key:Math.random()},a.substring(0,a.length))),a="")}return n},Y=function(e,t){return{year:e.getFullYear(),month:e.getMonth()+t}},V=function(e){var t=new Date(e);return t.setHours(0,0,0,0),t},G=function(e){var t=new Date(e);return t.setHours(23,59,59,999),t},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Y(e,t),a=n.year,r=n.month,i=1,c=new Date(a,r,i);return V(c)},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Y(e,t),a=n.year,r=n.month,i=r+1,c=0,o=new Date(a,i,c);return G(o)},X=function(e){return e.toLocaleString("en-us",{month:"short"})},z=function(e){if(navigator.userAgent.match("CriOS")){var t=new FileReader;t.onload=function(){return window.location.href=t.result},t.readAsDataURL(e)}else Object(P.saveAs)(e,e.name)},Z=function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){var e=Object(p.a)(m.a.mark((function e(n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(n.target.result));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.onerror=function(e){return n(e)},a.readAsArrayBuffer(e)}))},Q=function(e){var t;return(t=[]).concat.apply(t,Object(A.a)(e))},ee="".concat(45,"%"),te="".concat(16,"%"),ne="".concat(17,"%"),ae="".concat(22,"%"),re=function(e){var t=e.invoice,n=t.uuid,a=t.payee,i=t.payor,c=t.currency,o=t.items,s=t.discount,l=t.taxPercent,u=t.shipping,d=t.note,m=t.dateIssued&&q(new Date(t.dateIssued))?new Date(t.dateIssued).toLocaleDateString():"",p=t.dateDue&&q(new Date(t.dateDue))?new Date(t.dateDue).toLocaleDateString():"",v=!(!t.datePaid||!q(new Date(t.datePaid)))&&new Date(t.datePaid).toLocaleDateString(),E=me(o),h=pe(E,s),f=ve(l,h),g=Ee(h,f,u),b=s>0&&!isNaN(Number(s))?H(Number(s)):H(0),w=u>0&&!isNaN(Number(u))?H(Number(u)):H(0);return r.a.createElement(M.a,{subject:JSON.stringify(t)},r.a.createElement(M.b,{size:"A4"},r.a.createElement(M.d,{style:{padding:"1in"}},r.a.createElement(M.d,{style:{flexDirection:"row"}},r.a.createElement(M.d,{style:{flexDirection:"column",width:"25%"}},r.a.createElement(M.c,{style:{fontSize:27}},"INVOICE")),r.a.createElement(M.d,{style:{flexDirection:"column",width:"75%",textAlign:"right"}},r.a.createElement(M.c,{style:{fontSize:14}},"".concat(a.name)),r.a.createElement(M.c,{style:{fontSize:14}},"".concat(a.email)))),r.a.createElement(M.d,{style:{flexDirection:"row",marginTop:"30px"}},v&&r.a.createElement(M.d,{style:{flexDirection:"column",width:"15%",textAlign:"left"}},r.a.createElement(M.c,{style:{fontSize:16,color:"red"}},"PAID")),v&&r.a.createElement(M.d,{style:{flexDirection:"column",width:"20%",textAlign:"right"}},r.a.createElement(M.c,{style:{fontSize:16,color:"red"}},v)),r.a.createElement(M.d,{style:{flexDirection:"column",width:v?"65%":"100%",textAlign:"right"}},r.a.createElement(M.c,{style:{fontSize:16}},"BILL TO"))),r.a.createElement(M.d,{style:{flexDirection:"row",marginTop:"40px"}},r.a.createElement(M.d,{style:{flexDirection:"column",width:"15%"}},r.a.createElement(M.c,{style:{fontSize:14}},"ISSUED"),r.a.createElement(M.c,{style:{fontSize:14}},"DUE"),r.a.createElement(M.c,{style:{fontSize:14}},"ID")),r.a.createElement(M.d,{style:{flexDirection:"column",width:"20%",textAlign:"right"}},r.a.createElement(M.c,{style:{fontSize:14}},m),r.a.createElement(M.c,{style:{fontSize:14}},p),r.a.createElement(M.c,{style:{fontSize:14}},n.substring(0,8))),r.a.createElement(M.d,{style:{flexDirection:"column",width:"65%",textAlign:"right"}},r.a.createElement(M.c,{style:{fontSize:14}},i.name),i.email&&r.a.createElement(M.d,null,r.a.createElement(M.c,{style:{fontSize:14}},i.email)))),r.a.createElement(M.d,{style:{marginTop:"80px",fontSize:14}},r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"14px"}},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ee,textAlign:"left",backgroundColor:"black"}},r.a.createElement(M.c,{style:{color:"white"}},"Item")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:te,textAlign:"right",backgroundColor:"black"}},r.a.createElement(M.c,{style:{color:"white"}},"Quantity")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ne,textAlign:"right",backgroundColor:"black"}},r.a.createElement(M.c,{style:{color:"white"}},"Price")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right",backgroundColor:"black"}},r.a.createElement(M.c,{style:{color:"white"}},"Amount"))),o.map((function(e,t){var n=e.quantity,a=e.unitPrice;return n<0||a<0||isNaN(Number(n))||isNaN(Number(a))?null:r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"12px",marginTop:"8px",fontSize:14},key:t},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ee,textAlign:"left"}},r.a.createElement(M.c,{style:{color:"black"}},e.name)),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:te,textAlign:"right"}},r.a.createElement(M.c,{style:{color:"black"}},e.quantity)),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ne,textAlign:"right"}},r.a.createElement(M.c,{style:{color:"black"}},H(Number(e.unitPrice)))),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right"}},r.a.createElement(M.c,{style:{color:"black"}},$[c]+H(de(e)))))})),r.a.createElement(M.d,{style:{flexDirection:"row",backgroundColor:"black",marginTop:5,height:1,width:"".concat(55,"%"),marginLeft:"".concat(45,"%")}}),r.a.createElement(M.d,{style:{flexDirection:"row",backgroundColor:"black",marginTop:1,marginBottom:5,height:1,width:"".concat(55,"%"),marginLeft:"".concat(45,"%")}}),s||l||u?r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"14px"}},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:"".concat(78,"%"),textAlign:"right"}},r.a.createElement(M.c,null,"SUBTOTAL")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right"}},r.a.createElement(M.c,null,$[c]+H(E)))):null,s?r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"14px"}},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:"".concat(78,"%"),textAlign:"right"}},r.a.createElement(M.c,null,"DISCOUNT")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right"}},r.a.createElement(M.c,null,$[c]+b))):null,l?r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"14px"}},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:"".concat(78,"%"),textAlign:"right"}},r.a.createElement(M.c,null,"TAX (",l,"%)")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right"}},r.a.createElement(M.c,null,$[c]+H(f)))):null,u?r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"14px"}},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:"".concat(78,"%"),textAlign:"right"}},r.a.createElement(M.c,null,"SHIPPING")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right"}},r.a.createElement(M.c,null,$[c]+w))):null,r.a.createElement(M.d,{style:{flexDirection:"row",lineHeight:"14px"}},r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:"".concat(45,"%"),textAlign:"left",marginTop:s||l||u?"0":"28px"}},r.a.createElement(M.c,null,d)),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:"".concat(33,"%"),textAlign:"right"}},r.a.createElement(M.c,null,"TOTAL")),r.a.createElement(M.d,{style:{padding:3,flexDirection:"column",width:ae,textAlign:"right"}},r.a.createElement(M.c,null,$[c]+H(g))))))))},ie=function(e){var t=(new Date).toISOString();return e.map((function(e){var n=e.sql,a=e.bindValues;return{sql:n,bindValues:Object(u.a)(Object(u.a)({},a),{},{$created_date:t})}}))},ce=function(e,t){for(var n=[],a=e.prepare(t);a.step();)n.push(a.getAsObject());return a.free(),n},oe=function(e,t){var n=[];n.length=e.length;var a="(".concat(n.fill("?"),")"),r=[];return r.length=t.length,r.fill(a).toString()},se=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e,a){var r;return Object(v.a)(this,n),(r=t.call(this)).errors=e,r.errorMap=a,r}return n}(Object(U.a)(Error)),le=function(e,t){var n=Object(u.a)({},be(e,t.userId)),a=n.name,r=n.currency;return{uuid:Object(_.a)(),dateIssued:new Date,dateDue:B(new Date,28),items:[ue()],payor:{uuid:Object(_.a)()},payee:Object(u.a)(Object(u.a)({},t),{},{name:a||""}),currency:r||"USD",discount:0,taxPercent:0,shipping:0,note:""}},ue=function(){return{resourceUuid:Object(_.a)(),name:"",quantity:1,unitPrice:0}},de=function(e){return e.quantity<=0||e.unitPrice<=0||isNaN(Number(e.quantity))||isNaN(Number(e.unitPrice))?new s.a(0):new s.a(e.quantity).multipliedBy(new s.a(e.unitPrice))},me=function(e){for(var t=new s.a(0),n=0;n<e.length;n++){var a=de(e[n]);a.isPositive()&&(t=t.plus(a))}return t},pe=function(e,t){var n=t>0&&!isNaN(Number(t))?new s.a(t):new s.a(0),a=e.minus(n);return a.isNegative()?new s.a(0):a},ve=function(e,t){if(e<=0||isNaN(Number(e)))return new s.a(0);var n=new s.a(e).dividedBy(100);return t.multipliedBy(n)},Ee=function(e,t,n){var a=n>0&&!isNaN(Number(n))?new s.a(n):new s.a(0);return e.plus(t).plus(a)},he=function(e){var t,n=[],a={payee:{},payor:{},items:{}},r=e.payee,i=e.payor,c=e.dateIssued,o=e.dateDue,s=e.items,l=e.discount,u=e.taxPercent,d=e.shipping;if(r.name||(n.push("Your name is missing. Please include your name."),a.payee.name=!0),i.name||(n.push("BILL TO name is missing. Please include a name to bill."),a.payor.name=!0),i.email&&(t=i.email,!/^(([^<>()\\[\]\\.,;:\s@"]+(\.[^<>()\\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t))&&(n.push("BILL TO email is invalid. Please enter a valid email address."),a.payor.email=!0),q(new Date(c))||(n.push("Invalid date issued. Please make sure the date is valid and has format YYYY-MM-DD."),a.dateIssued=!0),o&&!q(new Date(o))&&(n.push("Invalid date due. Please make sure the date is valid and has format YYYY-MM-DD."),a.dateDue=!0),function(e,t,n){for(var a=0;a<e.length;a++){var r=e[a],i=r.resourceUuid,c=r.name,o=r.quantity,s=r.unitPrice;n.items[i]={};var l=a+1;c||(t.push("Item ".concat(l," is missing an Item name.")),n.items[i].name=!0),o||0===o?o<=0&&(t.push("Item ".concat(l," has Quantity less than or equal to 0. Please include a positive quantity.")),n.items[i].quantity=!0):(t.push("Item ".concat(l," is missing a Quantity.")),n.items[i].quantity=!0),s||0===s||(t.push("Item ".concat(l," is missing a Price.")),n.items[i].unitPrice=!0),s<0&&(t.push("Item ".concat(l," has Price less than 0. Please include a price greater than or equal to 0.")),n.items[i].unitPrice=!0)}}(s,n,a),l<0&&(n.push("Discount provided is less than 0. Please include a discount greater than or equal to 0."),a.discount=!0),u<0&&(n.push("Tax provided is less than 0. Please include a tax greater than or equal to 0."),a.taxPercent=!0),d<0&&(n.push("Shipping cost provided is less than 0. Please include a shipping cost greater than or equal to 0."),a.shipping=!0),n.length)throw new se(n,a)},fe=function(e){for(var t=e.payee,n=e.payor,a=e.dateDue,r=e.currency,i=e.items,c=e.discount,o=e.taxPercent,s=e.shipping,l=e.note,u=me(i),d=pe(u,c),m=ve(o,d),p=$[r]+H(Ee(d,m,s)),v=q(new Date(a))?" due "+new Date(a).toLocaleDateString():"",E="",h=0;h<i.length;h++){var f=i[h],g=f.name,b=f.quantity,w=f.unitPrice;b<0||w<0||isNaN(Number(b))||isNaN(Number(w))||(E+="".concat(g," (").concat(b," x ").concat($[r]).concat(H(Number(w)),")\n"))}var N=encodeURIComponent("Invoice from ".concat(t.name||""," for ").concat(p)),y=encodeURIComponent("Hi ".concat(n.name||"",",\n")+"\n"+"Here is an invoice for ".concat(p).concat(v,".\n")+"\n"+E+"\n"+(l||"Thank you!")+"\n\n"+"".concat(t.name||""));return"mailto:".concat(n.email||"","?subject=").concat(N,"&body=").concat(y)},ge=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,a,i,c,o,s,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(M.e)(r.a.createElement(re,{invoice:t})),e.next=3,n.toBlob();case 3:a=e.sent,i=t.payor,c=t.dateIssued,o=q(new Date(c))?"-".concat(new Date(c).toLocaleDateString()):"",s="Invoice-".concat(i.name||"").concat(o,".pdf"),l=new File([a],s,{type:"application/pdf"}),z(l);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(e,t){var n="\n    SELECT *\n    FROM user\n    WHERE uuid = '".concat(t,"';\n  "),a=ce(e,n);return a.length?a[0]:{}},we=function(e){return ce(e,"\n    SELECT *\n    FROM resource;\n  ")},Ne=function(e){var t=e.uuid,n=e.payee,a=e.payor,r=e.currency,i=e.dateIssued,c=e.dateDue,o=e.discount,s=e.taxPercent,l=e.shipping,u=e.note;return{sql:"\n      INSERT INTO invoice (\n        uuid,\n        date_issued, date_paid, date_due,\n        currency, discount, tax_percent, shipping, note,\n        payee_uuid, payee_name, payee_email,\n        payor_uuid, payor_name, payor_email,\n        created_date\n      )\n      VALUES (\n        $uuid, $date_issued, $date_paid, $date_due,\n        $currency, $discount, $tax_percent, $shipping, $note,\n        $payee_uuid, $payee_name, $payee_email,\n        (".concat("\n    SELECT uuid\n    FROM agent\n    WHERE name = $payor_name COLLATE NOCASE\n  ","), $payor_name, $payor_email,\n        $created_date\n      );\n    "),bindValues:{$uuid:t,$date_issued:new Date(i).toISOString(),$date_due:c?new Date(c).toISOString():null,$currency:r,$discount:o,$tax_percent:s,$shipping:l,$note:u,$payee_uuid:n.userId,$payee_name:n.name,$payee_email:n.email,$payor_name:a.name,$payor_email:a.email}}},ye=function(e,t,n){var a=t.name,r=t.unitPrice,i=t.quantity;return{sql:"\n      INSERT INTO invoice_item (invoice_uuid, item_number, item_name, quantity, unit_price, created_date, resource_uuid)\n      VALUES ($invoice_uuid, $item_number, $item_name, $quantity, $unit_price, $created_date, (".concat("\n    SELECT uuid\n    FROM resource\n    WHERE name = $item_name COLLATE NOCASE\n  ","));\n    "),bindValues:{$invoice_uuid:e,$item_number:n,$item_name:a,$unit_price:r,$quantity:i}}},Oe=function(e){return{sql:"\n      INSERT INTO resource (uuid, name, unit_price, created_date)\n      VALUES ($uuid, $name, $unit_price, $created_date)\n      ON CONFLICT DO NOTHING;\n    ",bindValues:{$uuid:e.resourceUuid,$name:e.name,$unit_price:e.unitPrice}}},Se=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,a,r,i,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.payee,u=t.currency,n={sql:"\n      INSERT INTO user (uuid, name, currency, created_date)\n      VALUES ($uuid, $name, $currency, $created_date)\n      ON CONFLICT(uuid) DO NOTHING;\n    ",bindValues:{$uuid:l.userId,$name:l.name,$currency:u}},s=t.payor,a={sql:"\n      INSERT INTO agent (uuid, name, email, created_date)\n      VALUES ($uuid, $name, $email, $created_date)\n      ON CONFLICT DO NOTHING;\n    ",bindValues:{$uuid:s.uuid,$name:s.name,$email:s.email}},r=t.items.map((function(e){return Oe(e)})),i=t.items.map((function(e,n){return ye(t.uuid,e,n)})),c=Ne(t),o=ie([n,a].concat(Object(A.a)(r),Object(A.a)(i),[c])),e.next=8,window.userbase.execSql({databaseName:"prinvoice_main",sqlStatements:o});case 8:case"end":return e.stop()}var s,l,u}),e)})));return function(t){return e.apply(this,arguments)}}(),De=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).handleClickOutsideProductsDropdown=function(e){var t=a.state.productDropdownOpen;t&&t&&a.productDropdownRef&&!a.productDropdownRef.current.contains(e.target)&&a.setState({productDropdownOpen:!1})},a.handleHitEnter=function(e){if(a.state.productDropdownOpen){"Enter"!==e.key&&13!==e.keyCode||a.setState({productDropdownOpen:!1})}},a.handleToggleProductDropdown=function(){a.setState({productDropdownOpen:!0})},a.handleSetItem=function(e,t){a.props.handleSetItem(e,t),a.setState({productDropdownOpen:!1})},a.state={error:void 0,productDropdownOpen:!1},a.productDropdownRef=r.a.createRef(),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleClickOutsideProductsDropdown),document.addEventListener("keydown",this.handleHitEnter)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClickOutsideProductsDropdown),document.removeEventListener("keydown",this.handleHitEnter)}},{key:"render",value:function(){var e=this,t=this.props,n=t.item,a=t.itemIndex,i=t.currency,c=t.canRemove,o=t.productDropdownOptions,s=t.chosenProducts,l=t.handleRemoveItem,u=t.handleUpdateItem,d=t.errorMap,m=this.state.productDropdownOpen;return r.a.createElement("tr",{className:"invoice-form-item-row"},r.a.createElement("td",null,c&&r.a.createElement("div",{className:"invoice-form-item-row-cancel-button no-select",onClick:function(){return l(n.resourceUuid)}},"x"),r.a.createElement("input",{className:"text-input item-input"+(d.name?" invalid":""),placeholder:"Item name*",value:n.name||"",autoComplete:"none",onFocus:this.handleToggleProductDropdown,onChange:function(e){return u(a,n.resourceUuid,"name",e.target.value)}}),m&&r.a.createElement("div",{className:"dropdown active",id:"new-invoice-form-dropdown-menu",ref:this.productDropdownRef},r.a.createElement("div",{className:"dropdown-content"},o.filter((function(e){return!s[e.uuid]&&(!n.name||-1!==e.name.toLowerCase().indexOf(n.name.toLowerCase()))})).map((function(t){return r.a.createElement("div",{className:"dropdown-item",key:t.uuid,onClick:function(){return e.handleSetItem(a,t)}},W(t.name,n.name),r.a.createElement("div",{className:"dropdown-item-label"},$[i],H(t.unit_price)))}))))),r.a.createElement("td",{className:"invoice-form-quantity-input-row"},r.a.createElement("input",{className:"text-input quantity-input"+(Number(n.quantity)>0&&!d.quantity?"":" invalid"),type:"number",required:!0,value:n.quantity,onChange:function(e){return u(a,n.resourceUuid,"quantity",e.target.value)}}),r.a.createElement("span",{className:"invoice-form-multiply-sign"},"X")),r.a.createElement("td",{className:"invoice-form-price-input-row"},r.a.createElement("span",{className:"invoice-form-price-input-currency-sign"},$[i]),r.a.createElement("input",{className:"text-input price-input validity"+(Number(n.unitPrice)>=0&&!d.unitPrice?"":" invalid"),type:"number",min:"0",step:"any",required:!0,value:n.unitPrice,onChange:function(e){return u(a,n.resourceUuid,"unitPrice",e.target.value)}})),r.a.createElement("td",{className:"invoice-form-item-amount-cell input-height"},c&&r.a.createElement("span",{className:"invoice-form-delete-item-mobile",onClick:function(){return l(n.resourceUuid)}},"Remove"),r.a.createElement("span",{className:"currency-symbol"},$[i]),r.a.createElement("span",{className:"invoice-form-item-amount"},H(de(n)))))}}]),n}(a.Component),Ce=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a,i;return Object(v.a)(this,n),(a=t.call(this,e)).handleUpdateAgent=function(e,t,n){var r=a.state,i=r.invoice,c=r.errorMap;i[e][t]=n,delete c[e][t];var o=!1;"payor"===e&&"name"===t&&(o=!0,i[e].uuid=Object(_.a)()),a.setState({invoice:i,errorMap:c,customerDropdownOpen:o})},a.handleChangeCurrency=function(e){var t=a.state.invoice;a.setState({invoice:Object(u.a)(Object(u.a)({},t),{},{currency:e.target.value})})},a.handleAddItem=function(){var e=a.state.invoice,t=e.items;t.push(ue()),a.setState({invoice:Object(u.a)(Object(u.a)({},e),{},{items:t})})},a.handleRemoveItem=function(e){for(var t=a.state,n=t.invoice,r=t.errorMap,i=n.items,c=[],o=0;o<i.length;o++){var s=i[o];s.resourceUuid!==e&&c.push(s)}delete r.items[e],a.setState({invoice:Object(u.a)(Object(u.a)({},n),{},{items:c}),errorMap:r})},a.handleUpdateItem=function(e,t,n,r){var i=a.state,c=i.invoice,o=i.errorMap,s=c.items,l=s[e];if(l&&l.resourceUuid===t)s[e][n]=r,s[e].resourceUuid="name"===n?Object(_.a)():s[e].resourceUuid;else for(var d=0;d<s.length;d++){var m=s[d];m.resourceUuid===t&&(m[n]=r,m.resourceUuid="name"===n?Object(_.a)():m.resourceUuid)}o.items[t]&&delete o.items[t][n],a.setState({invoice:Object(u.a)(Object(u.a)({},c),{},{items:s}),errorMap:o})},a.handleUpdateInvoiceProperty=function(e,t){var n=a.state,r=n.invoice,i=n.errorMap;r[e]=t,delete i[e],a.setState({invoice:r,errorMap:i})},a.handleOpenTaxEditor=function(){a.setState({editingTax:!0})},a.handleClickOutsideTaxWrapper=function(e){a.state.editingTax&&a.taxWrapperRef&&!a.taxWrapperRef.current.contains(e.target)&&a.setState({editingTax:!1})},a.handleClickOutsideCustomersDropdown=function(e){a.state.customerDropdownOpen&&a.customerDropdownRef&&!a.customerDropdownRef.current.contains(e.target)&&a.setState({customerDropdownOpen:!1})},a.handleHitEnter=function(e){var t=a.state,n=t.editingTax,r=t.customerDropdownOpen;if(n||r){"Enter"!==e.key&&13!==e.keyCode||a.setState({editingTax:!1,customerDropdownOpen:!1})}},a.handleSaveInvoice=Object(p.a)(m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,n=t.invoice,r=t.loading,i=t.errorMap,!r){e.next=3;break}return e.abrupt("return");case 3:return a.setState({loading:!0}),e.prev=4,a.topOfPageRef.current.scrollIntoView({behavior:"smooth"}),he(n),e.next=9,Se(n);case 9:a.setState({loading:!1}),window.location.hash="#invoices",e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),a.setState({loading:!1,errors:e.t0.errors||[e.t0.message],errorMap:e.t0.errorMap||i});case 16:case"end":return e.stop()}}),e,null,[[4,13]])}))),a.handleToggleDropdown=function(e,t){a.setState(Object(g.a)({},e,t))},a.handleSetPayor=function(e){var t=a.state,n=t.invoice,r=t.errorMap;delete r.payor.name,a.setState({invoice:Object(u.a)(Object(u.a)({},n),{},{payor:Object(u.a)({},e),errorMap:r}),customerDropdownOpen:!1})},a.handleSetItem=function(e,t){var n=a.state.invoice,r=n.items,i=t.uuid,c=t.name,o=t.unit_price;r[e]={resourceUuid:i,unitPrice:o,name:c,quantity:1},a.setState({invoice:Object(u.a)(Object(u.a)({},n),{},{items:r})})},a.handleClickOutsideMoreOptionsDropdown=function(e){a.state.moreOptionsOpen&&a.moreOptionsRef&&!a.moreOptionsRef.current.contains(e.target)&&a.mobileMoreOptionsRef&&!a.mobileMoreOptionsRef.current.contains(e.target)&&a.setState({moreOptionsOpen:!1})},a.handleToggleMoreOptions=function(){var e=a.state.moreOptionsOpen;a.setState({moreOptionsOpen:!e})},a.state={errors:[],errorMap:{items:{},payor:{},payee:{}},loading:!1,invoice:le(a.props.sqlJsDb,a.props.user),editingTax:!1,customerDropdownOptions:(i=a.props.sqlJsDb,ce(i,"\n    SELECT *\n    FROM agent;\n  ")),productDropdownOptions:we(a.props.sqlJsDb),customerDropdownOpen:!1,moreOptionsOpen:!1},a.topOfPageRef=r.a.createRef(),a.customerDropdownRef=r.a.createRef(),a.taxWrapperRef=r.a.createRef(),a.moreOptionsRef=r.a.createRef(),a.mobileMoreOptionsRef=r.a.createRef(),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleClickOutsideTaxWrapper),document.addEventListener("mousedown",this.handleClickOutsideCustomersDropdown),document.addEventListener("mousedown",this.handleClickOutsideMoreOptionsDropdown),document.addEventListener("keydown",this.handleHitEnter)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClickOutsideTaxWrapper),document.removeEventListener("mousedown",this.handleClickOutsideCustomersDropdown),document.removeEventListener("mousedown",this.handleClickOutsideMoreOptionsDropdown),document.removeEventListener("keydown",this.handleHitEnter)}},{key:"render",value:function(){var e=this,t=this.state,n=t.invoice,a=t.editingTax,i=t.loading,c=t.errors,o=t.errorMap,s=t.customerDropdownOptions,l=t.customerDropdownOpen,u=t.moreOptionsOpen,d=n.uuid,m=n.payee,p=n.payor,v=n.dateIssued,E=n.dateDue,h=n.currency,f=n.items,g=n.discount,w=n.taxPercent,N=n.shipping,y=me(f),O=pe(y,g),S=ve(w,O),D=Ee(O,S,N);return r.a.createElement("div",{id:"new-invoice-page",ref:this.topOfPageRef},r.a.createElement("div",{className:"topnav-container fixed"},r.a.createElement("ul",{className:"topnav max-screen-width"},r.a.createElement("li",null,r.a.createElement("button",{className:"button-inverted new-invoice-nav-button",id:"cancel-invoice-button",onClick:function(){return window.confirm("Are you sure you want to cancel invoice?")&&window.history.back()}},"CANCEL")),r.a.createElement("li",{className:"new-invoice-header"},"New Invoice"),r.a.createElement("li",{id:"new-invoice-nav-save-button-wrapper",className:"right",ref:this.moreOptionsRef},r.a.createElement("button",{className:"button-inverted new-invoice-nav-button",id:"save-invoice-button",onClick:this.handleSaveInvoice},"SAVE"),r.a.createElement("button",{className:"button-inverted new-invoice-nav-button",id:"more-options-invoice-button",onClick:this.handleToggleMoreOptions},r.a.createElement("span",{className:"triangle-down"})),u&&r.a.createElement("div",{className:"dropdown active"},r.a.createElement("div",{className:"dropdown-content"},r.a.createElement("div",{className:"dropdown-item",onClick:function(){return window.location.href=fe(n)}},"Send",r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:L.faEnvelope}))),r.a.createElement("div",{className:"dropdown-item",onClick:function(){return ge(n)}},"Download PDF",r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:I.faFilePdf}))))))),i&&r.a.createElement("div",{className:"loader fixed"})),r.a.createElement("div",{id:"new-invoice-form"},c&&c.length>0&&r.a.createElement("div",{className:"invoice-errors"},c.map((function(e,t){return r.a.createElement("div",{key:t,className:"error"},r.a.createElement("span",{className:"error-icon"},r.a.createElement(b.a,{icon:k.faExclamationTriangle})),e)}))),r.a.createElement("div",{className:"paper-container"},r.a.createElement("div",{className:"inner-paper-container"},r.a.createElement("div",{className:"invoice-form-title"},"INVOICE"),r.a.createElement("div",{className:"invoice-form-bill-from"},r.a.createElement("div",{className:"invoice-form-bill-from-title invoice-form-section-title"},"Bill from"),r.a.createElement("input",{className:"text-input"+(o.payee.name?" invalid":""),type:"text",placeholder:"Your name*",value:m.name,onChange:function(t){return e.handleUpdateAgent("payee","name",t.target.value)}}),r.a.createElement("div",{className:"input-padding input-font-size pr-0"},m.email)),r.a.createElement("div",{className:"invoice-form-bill-to"},r.a.createElement("div",{className:"invoice-form-bill-to-title invoice-form-section-title"},"Bill to"),r.a.createElement("div",{className:"invoice-form-bill-to-content"},r.a.createElement("input",{className:"text-input top-text-input"+(o.payor.name?" invalid":""),placeholder:"Name*",autoComplete:"none",value:p.name||"",onFocus:function(){return e.handleToggleDropdown("customerDropdownOpen",!0)},onChange:function(t){return e.handleUpdateAgent("payor","name",t.target.value)}}),l&&r.a.createElement("div",{className:"dropdown active",id:"new-invoice-form-dropdown-menu",ref:this.customerDropdownRef},r.a.createElement("div",{className:"dropdown-content"},l&&s.filter((function(e){return!p.name||-1!==e.name.toLowerCase().indexOf(p.name.toLowerCase())})).map((function(t){return r.a.createElement("div",{className:"dropdown-item",key:t.uuid,onClick:function(){return e.handleSetPayor(t)}},W(t.name,p.name),r.a.createElement("div",{className:"dropdown-item-label"},t.email))})))),r.a.createElement("input",{className:"text-input bottom-text-input"+(o.payor.email?" invalid":""),placeholder:"Email",autoComplete:"none",value:p.email||"",onChange:function(t){return e.handleUpdateAgent("payor","email",t.target.value)}}))),r.a.createElement("div",{className:"invoice-form-metadata"},r.a.createElement("div",{className:"invoice-form-metadata-row input-height"},r.a.createElement("div",{className:"invoice-form-metadata-title invoice-form-section-title"},"Issued"),r.a.createElement("div",{className:"invoice-form-metadata-content"},r.a.createElement("input",{className:"text-input top-text-input validity"+(o.dateIssued?" invalid":""),type:"date",defaultValue:F(v),placeholder:"yyyy-mm-dd",pattern:j,maxLength:10,onChange:function(t){return e.handleUpdateInvoiceProperty("dateIssued",t.target.value)}}))),r.a.createElement("div",{className:"invoice-form-metadata-row input-height"},r.a.createElement("div",{className:"invoice-form-metadata-title invoice-form-section-title"},"Due"),r.a.createElement("div",{className:"invoice-form-metadata-content"},r.a.createElement("input",{className:"text-input bottom-text-input validity"+(o.dateDue?" invalid":""),type:"date",defaultValue:F(E),placeholder:"yyyy-mm-dd",pattern:j,maxLength:10,onChange:function(t){return e.handleUpdateInvoiceProperty("dateDue",t.target.value)}}))),r.a.createElement("div",{id:"invoice-form-id",className:"invoice-form-metadata-row input-height"},r.a.createElement("div",{className:"invoice-form-metadata-title invoice-form-section-title"},"ID"),r.a.createElement("div",{className:"invoice-form-metadata-content",title:d},d.substring(0,8),r.a.createElement("span",{className:"hidden-but-copy-pastable-text"},d.substring(8))))),r.a.createElement("div",{className:"invoice-form-items-section"},r.a.createElement("div",{className:"invoice-form-items-section-title invoice-form-section-title"},"Items"),r.a.createElement("div",{className:"invoice-form-currency-selector invoice-form-off-text"},r.a.createElement("span",{className:"triangle-down"}),r.a.createElement("select",{defaultValue:h,onChange:this.handleChangeCurrency},Object.keys($).map((function(e){return r.a.createElement("option",{value:e,key:e},e)})))),r.a.createElement("table",{className:"invoice-form-items-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Item"),r.a.createElement("th",null,"Quantity"),r.a.createElement("th",null,"Price"),r.a.createElement("th",null,"Amount"))),r.a.createElement("tbody",null,function(){for(var t={},n=0;n<f.length;n++)t[f[n].resourceUuid]=!0;return f.map((function(n,a){return r.a.createElement(De,{key:a,item:n,itemIndex:a,canRemove:f.length>1,currency:h,productDropdownOptions:e.state.productDropdownOptions,chosenProducts:t,handleRemoveItem:e.handleRemoveItem,handleUpdateItem:e.handleUpdateItem,handleSetItem:e.handleSetItem,errorMap:o.items[n.resourceUuid]||{}})}))}(),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("input",{id:"add-item-button",className:"button",type:"button",value:"Add an item",onClick:this.handleAddItem})))),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"double-border",colSpan:"4"})),r.a.createElement("tr",{className:"input-height"},r.a.createElement("td",null),r.a.createElement("td",{className:"invoice-form-footer-header",colSpan:"2"},"Subtotal"),r.a.createElement("td",{className:"invoice-form-footer-value"},r.a.createElement("div",{className:"currency-symbol"},$[h]),r.a.createElement("div",{className:"invoice-form-item-amount"},H(y)))),r.a.createElement("tr",{id:"discount-input-row",className:"input-height"},r.a.createElement("td",null),r.a.createElement("td",{className:"invoice-form-footer-header",colSpan:"2"},"Discount"),r.a.createElement("td",{className:"invoice-form-footer-value"},r.a.createElement("div",{className:"currency-symbol input-height"},$[h]),r.a.createElement("input",{className:"text-input invoice-form-footer-property-input validity"+(Number(g)>=0&&!o.discount?"":" invalid"),type:"number",min:"0",step:"any",value:g,onChange:function(t){return e.handleUpdateInvoiceProperty("discount",t.target.value)}}))),r.a.createElement("tr",{className:"input-height"},r.a.createElement("td",null),r.a.createElement("td",{className:"invoice-form-footer-header",colSpan:"2"},r.a.createElement("span",{id:"invoice-form-tax-header",ref:this.taxWrapperRef,onClick:this.handleOpenTaxEditor},r.a.createElement("span",{style:{paddingRight:"8px"}},"Tax"),r.a.createElement("span",{className:"invoice-form-off-text"},"(",r.a.createElement("span",{className:"dotted-border-bottom"+(Number(w)>=0&&!o.taxPercent?"":" invalid")},a?r.a.createElement("input",{id:"invoice-form-tax-input",className:"input-no-style validity"+(Number(w)>=0&&!o.taxPercent?"":" invalid"),type:"number",min:"0",step:"any",onChange:function(t){return e.handleUpdateInvoiceProperty("taxPercent",t.target.value)},value:w}):w,"%"),")"))),r.a.createElement("td",{className:"invoice-form-footer-value"},r.a.createElement("div",{className:"currency-symbol"},$[h]),r.a.createElement("div",{className:"invoice-form-item-amount"},H(S)))),r.a.createElement("tr",{id:"shipping-input-row",className:"input-height"},r.a.createElement("td",null),r.a.createElement("td",{className:"invoice-form-footer-header",colSpan:"2"},"Shipping"),r.a.createElement("td",{className:"invoice-form-footer-value"},r.a.createElement("div",{className:"currency-symbol input-height"},$[h]),r.a.createElement("input",{className:"text-input validity invoice-form-footer-property-input"+(Number(N)>=0&&!o.shipping?"":" invalid"),type:"number",min:"0",step:"any",value:N,onChange:function(t,n){return e.handleUpdateInvoiceProperty("shipping",t.target.value,t,n)}}))),r.a.createElement("tr",{id:"invoice-form-final-row",className:"bold"},r.a.createElement("td",{id:"invoice-form-note"},r.a.createElement("textarea",{className:"text-input",placeholder:"Note",onChange:function(t,n){return e.handleUpdateInvoiceProperty("note",t.target.value,t,n)}})),r.a.createElement("td",{className:"invoice-form-footer-header input-height",colSpan:"2"},"Total"),r.a.createElement("td",{className:"invoice-form-footer-value input-height"},r.a.createElement("div",{className:"currency-symbol"},$[h]),r.a.createElement("div",{className:"invoice-form-item-amount"},H(D)))))),r.a.createElement("div",{id:"mobile-save-more-buttons",ref:this.mobileMoreOptionsRef},r.a.createElement("button",{className:"button-inverted",onClick:this.handleSaveInvoice},"SAVE"),r.a.createElement("div",{id:"mobile-more-button",className:"input-height"+(u?" active":""),onClick:this.handleToggleMoreOptions},"More options"),u&&r.a.createElement("div",null,r.a.createElement("button",{className:"button-inverted",style:{marginBottom:"1em"},onClick:function(){return window.location.href=fe(n)}},"Send",r.a.createElement(b.a,{style:{marginLeft:".5em"},icon:L.faEnvelope})),r.a.createElement("button",{className:"button-inverted",onClick:function(){return ge(n)}},"Download PDF",r.a.createElement(b.a,{style:{marginLeft:".5em"},icon:I.faFilePdf})))))))))}}]),n}(a.Component),xe=[{sql:"\n  CREATE TABLE version (\n    _v          PRIMARY KEY NOT NULL,\n    app_name    TEXT NOT NULL\n  );\n"},{sql:"\n  INSERT INTO version (_v, app_name)\n  VALUES ($_v, $app_name);\n",bindValues:{$_v:1,$app_name:"prinvoice"}},{sql:"\n  CREATE TABLE resource (\n    uuid              PRIMARY KEY,\n    name              TEXT NOT NULL,  \n    unit_price        REAL,\n    created_date      TEXT NOT NULL,\n    UNIQUE (name COLLATE NOCASE)\n  );\n"},{sql:"\n  CREATE TABLE agent (\n    uuid            PRIMARY KEY,\n    name            TEXT NOT NULL,\n    email           TEXT,\n    created_date    TEXT NOT NULL,\n    UNIQUE (name COLLATE NOCASE)\n  );\n"},{sql:"\n  CREATE TABLE invoice (\n    uuid            PRIMARY KEY NOT NULL,\n    date_issued     TEXT NOT NULL,\n    date_due        TEXT,\n    date_paid       TEXT,\n    currency        TEXT,\n    discount        REAL,\n    tax_percent     REAL,\n    shipping        REAL,\n    note            TEXT,\n\n    payee_uuid      TEXT,\n    payee_name      TEXT,\n    payee_email     TEXT,\n\n    payor_uuid      TEXT,\n    payor_name      TEXT,\n    payor_email     TEXT,\n\n    created_date    TEXT NOT NULL,\n    FOREIGN KEY(payor_uuid) REFERENCES agent(uuid)\n  );\n"},{sql:"\n  CREATE TABLE invoice_item (\n    invoice_uuid    TEXT NOT NULL,\n    item_number     INTEGER NOT NULL,\n    item_name       TEXT NOT NULL,\n    resource_uuid   REAL NOT NULL,\n    quantity        REAL NOT NULL,\n    unit_price      REAL NOT NULL,\n    created_date    TEXT NOT NULL,\n    PRIMARY KEY(invoice_uuid, item_number),\n    FOREIGN KEY(invoice_uuid) REFERENCES invoice(uuid),\n    FOREIGN KEY(resource_uuid) REFERENCES resource(uuid)\n  );\n"},{sql:"\n  CREATE TABLE user (\n    uuid               PRIMARY KEY NOT NULL,\n    name               TEXT,\n    currency           TEXT,\n    created_date       TEXT NOT NULL\n  );\n"}],Re=function(e,t){for(var n,a,r=e.exec("SELECT * FROM invoice;")[0],i=r.columns,c=r.values,o=-1,s=0;s<i.length;s++){var l=i[s];if("payee_uuid"===l?n=s:"payor_uuid"===l?a=s:"payor_name"===l&&(o=s),n>=0&&a>=0&&o>=0)break}for(var u=[],d=0;d<c.length;d++){c[d][n]=t;var m=[];m.length=i.length,m.fill("?"),m[a]="(".concat("\n      SELECT uuid\n      FROM agent\n      WHERE name = ? COLLATE NOCASE\n    ",")"),u.push("(".concat(m,")"));var p=c[d][o];c[d][a]=p}return{sql:"\n      INSERT INTO invoice (".concat(i,")\n      VALUES ").concat(u,"\n      ON CONFLICT DO NOTHING;\n    "),bindValues:Q(c)}},Te=function(e){for(var t,n=e.exec("SELECT * FROM invoice_item;")[0],a=n.columns,r=n.values,i=-1,c=0;c<a.length;c++){var o=a[c];if("resource_uuid"===o?t=c:"item_name"===o&&(i=c),t>=0&&i>=0)break}for(var s=[],l=0;l<r.length;l++){var u=[];u.length=a.length,u.fill("?"),u[t]="(".concat("\n      SELECT uuid\n      FROM resource\n      WHERE name = ? COLLATE NOCASE\n    ",")"),s.push("(".concat(u,")"));var d=r[l][i];r[l][t]=d}return{sql:"\n      INSERT INTO invoice_item (".concat(a,")\n      VALUES ").concat(s,"\n      ON CONFLICT DO NOTHING;\n    "),bindValues:Q(r)}},_e=function(e,t){var n=e.exec("SELECT * FROM ".concat(t,";"))[0],a=n.columns,r=n.values;return{sql:"\n      INSERT INTO ".concat(t," (").concat(a,")\n      VALUES ").concat(oe(a,r),"\n      ON CONFLICT DO NOTHING;\n    "),bindValues:Q(r)}},ke=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){var a=e.db;if(!n)try{n=a.exec("\n  SELECT _v\n  FROM version;\n")[0].values[0][0]}catch(r){n=0}1===n&&t({db:a})},e.next=3,window.userbase.openSqlJsDatabase({databaseName:"prinvoice_main",changeHandler:a});case 3:e.t0=n,e.next=1===e.t0?6:(e.t0,7);break;case 6:return e.abrupt("break",8);case 7:r=xe;case 8:if(!r){e.next=11;break}return e.next=11,window.userbase.execSql({databaseName:"prinvoice_main",sqlStatements:r});case 11:n=1;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(){var e=Object(p.a)(m.a.mark((function e(t,n){var a,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=Uint8Array,e.next=4,Z(t);case 4:e.t1=e.sent,i=new e.t0(e.t1),r=new window.sqlJs.Database(i),a=r.exec("\n  SELECT _v\n  FROM version;\n")[0].values[0][0],e.next=14;break;case 10:throw e.prev=10,e.t2=e.catch(0),console.warn(e.t2),new Error("Invalid backup file.");case 14:if(1===a){e.next=16;break}throw new Error("Incompatible version of Prinvoice.\n\nPlease use the latest version of Prinvoice to restore this backup.");case 16:return e.next=18,window.userbase.execSql({databaseName:"prinvoice_main",sqlStatements:[_e(r,"resource"),_e(r,"agent"),Re(r,n),Te(r)]});case 18:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),Ie="SUM((subtotal - discount) * (".concat("(100 + tax_percent) / 100",") + shipping) AS total"),Ae=function(e){var t="\n    SELECT\n      invoice.*,\n      invoice_uuid,  \n      ".concat("SUM(quantity * unit_price) AS subtotal","\n    FROM\n      invoice\n    INNER JOIN\n      invoice_item ON invoice_item.invoice_uuid = invoice.uuid\n    GROUP BY\n      invoice_uuid\n  "),n="\n    SELECT\n      *,\n      ".concat(Ie,"\n    FROM (").concat(t,")\n    GROUP BY invoice_uuid\n  "),a="\n    SELECT\n      invoice_with_total.*,\n      agent.name AS customer\n    FROM\n      (".concat(n,") AS invoice_with_total\n    INNER JOIN\n      agent ON agent.uuid = invoice_with_total.payor_uuid\n    ORDER BY\n      invoice_with_total.created_date DESC\n  ;");return ce(e,a)},Ue=function(e,t){var n='\n    SELECT *\n    FROM invoice_item\n    WHERE invoice_uuid = "'.concat(t,'"\n    ORDER BY item_number ASC\n  ;');return ce(e,n)},Me=function(e,t){return{uuid:e.uuid,dateIssued:e.date_issued,dateDue:e.date_due,datePaid:e.date_paid,currency:e.currency,discount:e.discount,taxPercent:e.tax_percent,shipping:e.shipping,note:e.note,payor:{name:e.payor_name,email:e.payor_email,uuid:e.payor_uuid},payee:{name:e.payee_name,email:e.payee_email,uuid:e.payee_uuid},items:t.map((function(e){return{itemNumber:e.item_number,name:e.item_name,quantity:e.quantity,unitPrice:e.unit_price}}))}},Pe=function(){var e=Object(p.a)(m.a.mark((function e(t,n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.userbase.execSql({databaseName:"prinvoice_main",sql:"\n      UPDATE invoice\n      SET date_paid = $date_paid\n      WHERE uuid = $uuid\n    ;",bindValues:{$date_paid:n?n.toISOString():null,$uuid:t}});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$e=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={sql:"\n      DELETE FROM invoice_item\n      WHERE invoice_uuid = $invoice_uuid\n    ;",bindValues:{$invoice_uuid:t}},a={sql:"\n      DELETE FROM invoice\n      WHERE uuid = $uuid\n    ;",bindValues:{$uuid:t}},e.next=4,window.userbase.execSql({databaseName:"prinvoice_main",sqlStatements:[n,a]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fe=(n(258),n(282)),je=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).handleClickOutsideDatePaidEditor=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.editingDatePaid,i=n.datePaidInEditMode,r){e.next=3;break}return e.abrupt("return");case 3:if(!r||!a.datePaidEditor||a.datePaidEditor.current.contains(t.target)){e.next=6;break}return e.next=6,a.handleSetDatePaid(a.props.invoice.uuid,i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleClickOutsideRowMenu=function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.state.rowMenuOpen){e.next=3;break}return e.abrupt("return");case 3:a.rowMenu&&!a.rowMenu.current.contains(t.target)&&a.setState({rowMenuOpen:!1});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleHitEnter=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.editingDatePaid,i=n.datePaidInEditMode,r){e.next=3;break}return e.abrupt("return");case 3:if(13,"Enter"!==t.key&&13!==t.keyCode){e.next=7;break}return e.next=7,a.handleSetDatePaid(a.props.invoice.uuid,i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleEditDatePaid=Object(p.a)(m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props,n=t.updatingRowStatus,r=t.handleUpdatingRowStatus,i=a.state.editingDatePaid,!n&&!i){e.next=4;break}return e.abrupt("return");case 4:a.setState({editingDatePaid:!0,rowMenuOpen:!1}),r(!0);case 6:case"end":return e.stop()}}),e)}))),a.handleUpdateDate=function(e){a.setState({datePaidInEditMode:e.target.value})},a.handleUnsetDatePaid=Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null,e.next=3,a.handleSetDatePaid(a.props.invoice.uuid,null);case 3:case"end":return e.stop()}}),e)}))),a.handleSetDatePaid=function(){var e=Object(p.a)(m.a.mark((function e(t,n){var r,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props.handleUpdatingRowStatus,!a.state.loading){e.next=4;break}return e.abrupt("return");case 4:if(i=a.props.invoice.date_paid,n!==i){e.next=9;break}return a.setState({editingDatePaid:!1}),r(!1),e.abrupt("return");case 9:if(e.prev=9,null===(c=null===n?n:new Date(n))||q(c)){e.next=13;break}return e.abrupt("return");case 13:return a.setState({loading:!0}),e.next=16,Pe(t,c);case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(9);case 20:a._isMounted&&(a.setState({loading:!1,editingDatePaid:!1}),r(!1));case 21:case"end":return e.stop()}}),e,null,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}(),a.handleToggleRowMenu=function(){var e=a.state.rowMenuOpen;a.setState({rowMenuOpen:!e})},a.handleEmailInvoiceLink=function(){var e=a.props,t=e.invoice,n=e.sqlJsDb,r=Ue(n,t.uuid),i=Me(t,r);window.location.href=fe(i)},a.handleDownloadInvoicePdf=Object(p.a)(m.a.mark((function e(){var t,n,r,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.invoice,r=t.sqlJsDb,i=Ue(r,n.uuid),c=Me(n,i),e.next=5,ge(c);case 5:case"end":return e.stop()}}),e)}))),a.handleDeleteInvocie=Object(p.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.invoice.uuid,e.prev=1,e.next=4,$e(t);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}}),e,null,[[1,6]])}))),a.state={editingDatePaid:!1,datePaidInEditMode:a.props.invoice.date_paid||new Date,loading:!1,rowMenuOpen:!1},a.datePaidEditor=r.a.createRef(),a.rowMenu=r.a.createRef(),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0,document.addEventListener("mousedown",this.handleClickOutsideDatePaidEditor),document.addEventListener("mousedown",this.handleClickOutsideRowMenu),document.addEventListener("keydown",this.handleHitEnter)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,document.removeEventListener("mousedown",this.handleClickOutsideDatePaidEditor),document.removeEventListener("mousedown",this.handleClickOutsideRowMenu),document.removeEventListener("keydown",this.handleHitEnter)}},{key:"render",value:function(){var e=this.props,t=e.invoice,n=e.updatingRowStatus,a=t.customer,i=t.date_due,c=t.date_paid,o=t.currency,s=t.total,l=this.state,u=l.editingDatePaid,d=l.datePaidInEditMode,m=l.loading,p=l.rowMenuOpen;return r.a.createElement("tr",null,r.a.createElement("td",{className:"invoice-dashboard-row-customer"},a),r.a.createElement("td",{className:"invoice-dashboard-row-date-due"},r.a.createElement("span",{className:"invoice-dashboard-row-due-prefix"},"Due: "),i?new Date(i).toLocaleDateString():"-"),r.a.createElement("td",{className:"invoice-dashboard-date-paid"+(c?" paid":"")+(n&&!u?" editing-another-date-paid":"")},m?r.a.createElement("div",{className:"loader"}):u?r.a.createElement("div",{ref:this.datePaidEditor},r.a.createElement("input",{className:"text-input validity",type:"date",defaultValue:F(d),placeholder:"yyyy-mm-dd",pattern:j,maxLength:10,onChange:this.handleUpdateDate}),r.a.createElement("span",{onClick:this.handleUnsetDatePaid,className:"invoice-dashboard-unset-date-paid"},"X")):r.a.createElement("span",{onClick:this.handleEditDatePaid},c?"Paid":"Unpaid")),r.a.createElement("td",{className:"invoice-dashboard-amount",style:{textAlign:"right"}},$[o],H(s)),r.a.createElement("td",{className:"invoice-dashboard-ellipsis-wrapper",ref:this.rowMenu,onClick:this.handleToggleRowMenu},r.a.createElement("div",{className:"invoice-dashboard-ellipsis no-select"+(p?" active":"")},"..."),r.a.createElement("div",{id:"invoice-dashboard-ellipsis-dropdown-wrapper"},r.a.createElement("div",{className:"dropdown"+(p?" active":"")},r.a.createElement("div",{className:"dropdown-content"},r.a.createElement("div",{className:"dropdown-item",onClick:this.handleEditDatePaid},"Mark as ",c?"unpaid":"paid",r.a.createElement("span",{className:"float-right"},$[o])),r.a.createElement("div",{className:"dropdown-divider"}),r.a.createElement("div",{className:"dropdown-item",onClick:this.handleEmailInvoiceLink},"Send",r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:L.faEnvelope}))),r.a.createElement("div",{className:"dropdown-item",onClick:this.handleDownloadInvoicePdf},"Download PDF",r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:I.faFilePdf}))),r.a.createElement("div",{className:"dropdown-divider"}),r.a.createElement("div",{className:"dropdown-item dangerous-hover",onClick:this.handleDeleteInvocie},"Delete",r.a.createElement("span",{className:"float-right"},r.a.createElement(b.a,{icon:Fe.faTrashAlt}))))))))}}]),n}(a.Component),Be=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).handleUpdatingRowStatus=function(e){a._isMounted&&a.setState({updatingRowStatus:e})},a.state={invoices:Ae(a.props.sqlJsDb),error:void 0,loading:!1,updatingRowStatus:!1},a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this,t=this.state,n=t.invoices,a=t.updatingRowStatus;return r.a.createElement("div",{id:"invoice-dashboard",className:"dashboard-with-table max-screen-width"},r.a.createElement("div",{className:"dashboard-with-table-total"},n.length," invoice",1===n.length?"":"s"),r.a.createElement("div",{className:"dashboard-with-table-outer-container"},r.a.createElement("div",{className:"container"},r.a.createElement("table",{className:"dashboard-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"invoice-dashboard-customer"},"Customer"),r.a.createElement("th",{className:"invoice-dashboard-date-due"},"Due"),r.a.createElement("th",{className:"invoice-dashboard-date-paid"},"Status"),r.a.createElement("th",{className:"invoice-dashboard-amount",style:{textAlign:"right"}},"Amount"),r.a.createElement("th",{className:"invoice-dashboard-ellipsis"}))),n.length>0&&r.a.createElement("tbody",null,n.map((function(t){return r.a.createElement(je,{key:t.uuid,invoice:t,handleUpdatingRowStatus:e.handleUpdatingRowStatus,updatingRowStatus:a,sqlJsDb:e.props.sqlJsDb})})))),!n.length&&r.a.createElement("div",{className:"create-invoice-to-get-started"},r.a.createElement("a",{href:"#new-invoice"},"Create an invoice")," to get started."))))}}]),n}(a.Component),He=function(e,t){var n="\n    SELECT    \n      invoice_uuid,\n      payor_uuid,\n      date_paid,\n      discount,\n      tax_percent,\n      shipping,\n      currency,\n      ".concat(function(e){return'\n  SUM(\n    CASE \n      WHEN invoice.currency = (SELECT currency FROM user WHERE uuid = "'.concat(e,'")\n      THEN (quantity * unit_price)\n      ELSE 0\n    END\n  ) AS subtotal\n')}(t),"\n    FROM\n      invoice\n    INNER JOIN\n      invoice_item ON invoice_item.invoice_uuid = invoice.uuid\n    GROUP BY\n      invoice_uuid\n  "),a="\n    SELECT\n      payor_uuid,\n      date_paid,\n      ".concat(function(e){return'\n  SUM(\n    CASE\n      WHEN currency = (SELECT currency FROM user WHERE uuid = "'.concat(e,'")\n      THEN ((subtotal - discount) * (').concat("(100 + tax_percent) / 100",") + shipping)\n      ELSE 0\n    END\n  ) AS total\n")}(t),"\n    FROM (").concat(n,")\n    GROUP BY invoice_uuid\n  "),r='\n    SELECT\n      agent.name AS customer,\n      agent.email,\n      (SELECT currency FROM user WHERE uuid = "'.concat(t,'") AS currency,\n      SUM(\n        CASE\n          WHEN date_paid IS NOT NULL\n          THEN total\n          ELSE 0\n        END\n      ) AS amount_received,\n      SUM(\n        CASE\n          WHEN date_paid IS NULL\n          THEN total\n          ELSE 0\n        END\n      ) AS amount_owes\n    FROM (').concat(a,")\n    INNER JOIN agent ON agent.uuid = payor_uuid\n    GROUP BY payor_uuid\n    ORDER BY LOWER(customer) ASC\n  ");return ce(e,r)},qe=(n(567),function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).state={customers:He(a.props.sqlJsDb,a.props.user.userId)},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.state.customers;return r.a.createElement("div",{id:"customer-dashboard",className:"dashboard-with-table max-screen-width"},r.a.createElement("div",{className:"dashboard-with-table-total"},e.length," customer",1===e.length?"":"s"),r.a.createElement("div",{className:"dashboard-with-table-outer-container"},r.a.createElement("div",{className:"container"},r.a.createElement("table",{className:"dashboard-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"customer-dashboard-customer"},"Customer"),r.a.createElement("th",{className:"customer-dashboard-email"},"Email"),r.a.createElement("th",{className:"customer-dashboard-owes",style:{textAlign:"right"}},"Owes"),r.a.createElement("th",{className:"customer-dashboard-received",style:{textAlign:"right"}},"Received"))),e.length>0&&r.a.createElement("tbody",null,e.map((function(e){var t=e.customer,n=e.email,a=e.currency,i=e.amount_owes,c=e.amount_received;return r.a.createElement("tr",{key:t},r.a.createElement("td",{className:"customer-dashboard-customer"},t),r.a.createElement("td",{className:"customer-dashboard-email"},n||""),r.a.createElement("td",{className:"customer-dashboard-owes",style:{textAlign:"right"}},r.a.createElement("span",{className:"customer-dashboard-owes-prefix"},"Owes: "),i?"".concat($[a]).concat(H(i)):"-"),r.a.createElement("td",{className:"customer-dashboard-received"+(c?" received":""),style:{textAlign:"right"}},c?"".concat($[a]).concat(H(c)):"-"))})))),!e.length&&r.a.createElement("div",{className:"create-invoice-to-get-started"},r.a.createElement("a",{href:"#new-invoice"},"Create an invoice")," to get started."))))}}]),n}(a.Component)),We=(n(568),function(e,t){var n='SELECT currency FROM user WHERE uuid = "'.concat(t,'"'),a=ce(e,n);return a.length?a[0].currency:"USD"}),Ye=function(e){return ce(e,"SELECT * FROM invoice LIMIT 1;").length>0},Ve="SUM(".concat("quantity * unit_price",") AS subtotal"),Ge="SUM((subtotal - discount) * (".concat("(100 + tax_percent) / 100",") + shipping) AS invoice_total"),Je=function(e,t,n,a){var r="\n    SELECT\n      ".concat(Ve,',\n      invoice_uuid,\n      discount,\n      shipping\n    FROM\n      invoice\n    INNER JOIN\n      invoice_item ON invoice_item.invoice_uuid = invoice.uuid\n    WHERE\n      invoice.date_issued BETWEEN "').concat(t.toISOString(),'" AND "').concat(n.toISOString(),'" AND \n      invoice.currency = "').concat(a,'"\n    GROUP BY\n      invoice_uuid\n  '),i="\n    SELECT ".concat("SUM(subtotal - discount + shipping) AS invoice_total_excluding_tax","\n    FROM (").concat(r,")\n    GROUP BY invoice_uuid\n  "),c="\n    SELECT SUM(invoice_total_excluding_tax) AS sales\n    FROM (".concat(i,");\n  ");return ce(e,c)},Ke=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;Object(v.a)(this,n);var r=(a=t.call(this,e)).props,i=r.sqlJsDb,c=r.user.userId;if(Ye(i)){var o=We(i,c),s=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=new Date,r=[],i=[],c=1;c<=n;c++){var o=J(a,-1*(n-c)),s=K(a,-1*(n-c));r.push(Je(e,o,s,t)[0].sales),i.push(X(o))}return{sales:r,months:i}}(i,o),l=function(e,t){var n="\n    SELECT\n      ".concat(Ve,',\n      invoice_uuid,\n      payor_uuid,\n      discount,\n      shipping\n    FROM\n      invoice\n    INNER JOIN\n      invoice_item ON invoice_item.invoice_uuid = invoice.uuid\n    WHERE\n      invoice.currency = "').concat(t,'"\n    GROUP BY\n      invoice_uuid\n  '),a="\n    SELECT\n      payor_uuid,\n      ".concat("SUM(subtotal - discount + shipping) AS invoice_total_excluding_tax","\n    FROM (").concat(n,")\n    GROUP BY invoice_uuid\n  "),r="\n    SELECT\n      agent.name AS customer,\n      SUM(invoice_total_excluding_tax) AS sales\n    FROM (".concat(a,")\n    INNER JOIN agent ON agent.uuid = payor_uuid\n    GROUP BY payor_uuid\n    ORDER BY sales DESC\n  "),i="\n    SELECT\n      *,\n      RANK() OVER (ORDER BY sales DESC) AS rank\n    FROM (".concat(r,")  \n  "),c="\n    SELECT *\n    FROM (".concat(i,")\n    WHERE rank <= ").concat(5,"\n  ;"),o='\n    SELECT\n      "Others" AS customer,     \n      SUM(sales) AS sales\n    FROM ('.concat(i,")\n    WHERE rank > ").concat(5,"\n  ;"),s=ce(e,c),l=ce(e,o),u=l[0].sales?s.concat(l):s;return{sales:u.map((function(e){return e.sales})),customers:u.map((function(e){return e.customer}))}}(i,o),u=function(e,t){var n="\n    SELECT\n      (".concat("quantity * unit_price",') AS item_amount,\n      resource_uuid\n    FROM\n      invoice\n    INNER JOIN\n      invoice_item ON invoice_item.invoice_uuid = invoice.uuid\n    WHERE\n      invoice.currency = "').concat(t,'"\n  '),a="\n    SELECT\n      resource.name AS product,\n      SUM(item_amount) AS sales\n    FROM (".concat(n,")\n    INNER JOIN resource ON resource.uuid = resource_uuid\n    GROUP BY resource_uuid\n    ORDER BY sales DESC\n  "),r="\n    SELECT\n      *,\n      RANK() OVER (ORDER BY sales DESC) AS rank\n    FROM (".concat(a,")  \n  "),i="\n    SELECT *\n    FROM (".concat(r,")\n    WHERE rank <= ").concat(5,"\n  ;"),c='\n    SELECT\n      "Others" AS product,     \n      SUM(sales) AS sales\n    FROM ('.concat(r,")\n    WHERE rank > ").concat(5,"\n  ;"),o=ce(e,i),s=ce(e,c),l=s[0].sales?o.concat(s):o;return{sales:l.map((function(e){return e.sales})),products:l.map((function(e){return e.product}))}}(i,o),d=function(e,t){var n="\n    SELECT    \n      invoice_uuid,\n      date_due,\n      date_paid,\n      discount,\n      tax_percent,\n      shipping,\n      ".concat(Ve,'\n    FROM\n      invoice\n    INNER JOIN\n      invoice_item ON invoice_item.invoice_uuid = invoice.uuid\n    WHERE\n      invoice.currency = "').concat(t,'"\n    GROUP BY\n      invoice_uuid\n  '),a="\n    SELECT\n      date_due,\n      date_paid,      \n      ".concat(Ge,"\n    FROM (").concat(n,")\n    GROUP BY invoice_uuid\n  "),r=(new Date).toISOString(),i='\n    SELECT\n      SUM(invoice_total) AS total,\n      SUM(\n        CASE\n          WHEN date_paid IS NOT NULL\n          THEN invoice_total\n          ELSE 0\n        END\n      ) AS received,\n      SUM(\n        CASE\n          WHEN date_paid IS NULL\n          THEN invoice_total\n          ELSE 0\n        END\n      ) AS owed,\n      SUM(\n        CASE\n          WHEN \n            date_paid IS NULL AND\n            date_due IS NOT NULL AND\n            date_due < "'.concat(r,'"\n          THEN invoice_total\n          ELSE 0\n        END\n      ) AS overdue\n    FROM (').concat(a,")\n  ;");return ce(e,i)[0]}(i,o),m=d.total,p=d.received,E=d.owed,h=d.overdue,f=function(e){return ce(e,"\n    SELECT COUNT(DISTINCT agent.uuid) AS count\n    FROM agent\n    INNER JOIN invoice ON invoice.payor_uuid = agent.uuid\n  ;")[0].count}(i);a.state={currency:o,monthlySales:s,salesByCustomer:l,salesByProduct:u,total:m,received:p,owed:E,overdue:h,customerCount:f}}else a.state={suggestCreateInvoice:!0};return a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.state,t=e.suggestCreateInvoice,n=e.currency,a=e.monthlySales,i=e.salesByCustomer,c=e.salesByProduct,o=e.total,s=e.received,u=e.owed,d=e.overdue,m=e.customerCount,p=t?"0":$[n]+H(o||0),v=t?"0":$[n]+H(s||0),E=t?"0":$[n]+H(u||0),h=t?"0":$[n]+H(d||0);return r.a.createElement("div",{id:"dashboard"},r.a.createElement("div",{className:"dashboard-outer-container"},r.a.createElement("div",{className:"container left-container"},r.a.createElement("div",{id:"dashboard-total-row"},r.a.createElement("div",{id:"dashboard-total-row-header"},"Total"),r.a.createElement("div",{id:"dashboard-total-row-value"},p)),r.a.createElement("div",{id:"dashboard-invoice-values-grid"},r.a.createElement("div",{id:"dashboard-received-value"},r.a.createElement("div",{className:"dashboard-invoice-values-header"},"Received"),r.a.createElement("div",{className:"dashboard-invoice-values-value"},v)),r.a.createElement("div",{id:"dashboard-owed-value"},r.a.createElement("div",{className:"dashboard-invoice-values-header"},"Owed"),r.a.createElement("div",{className:"dashboard-invoice-values-value"},E)),r.a.createElement("div",{id:"dashboard-overdue-value"},r.a.createElement("div",{className:"dashboard-invoice-values-header"},"Overdue"),r.a.createElement("div",{className:"dashboard-invoice-values-value"},h))),r.a.createElement("div",{id:"dashboard-customers-row"},r.a.createElement("div",{id:"dashboard-customers-row-header"},"Customers"),r.a.createElement("div",{id:"dashboard-customers-row-value"},m||0)))),r.a.createElement("div",{className:"dashboard-outer-container"},r.a.createElement("div",{className:"container right-container"},r.a.createElement("div",{className:"chart-header"},"Sales"),t?r.a.createElement("div",{className:"create-invoice-to-get-started"},r.a.createElement("a",{href:"#new-invoice"},"Create an invoice")," to get started."):r.a.createElement(l.Bar,{id:"sales-by-month-chart",data:{labels:a.months,datasets:[{data:a.sales,label:"Sales Revenue",backgroundColor:"#c3eee7",borderColor:"#66bbae",borderWidth:1}]},options:{maintainAspectRatio:!1,scales:{xAxes:[{gridLines:{drawBorder:!0,lineWidth:0}}],yAxes:[{gridLines:{drawBorder:!0,lineWidth:0},ticks:{min:0,callback:function(e){return $[n]+H(e,0)},fontColor:"black"}}]},tooltips:{callbacks:{label:function(e){return $[n]+H(e.yLabel)}}}},legend:null}))),r.a.createElement("div",{className:"dashboard-outer-container"},r.a.createElement("div",{id:"sales-by-customer",className:"container left-container"},r.a.createElement("div",{className:"chart-header"},"Sales by Customer"),t?r.a.createElement("div",{className:"create-invoice-to-get-started"},r.a.createElement("a",{href:"#new-invoice"},"Create an invoice")," to get started."):r.a.createElement(l.HorizontalBar,{data:{labels:i.customers,datasets:[{data:i.sales,label:"Sales Revenue",backgroundColor:"#c3eee7",borderColor:"#66bbae",borderWidth:1}]},options:{maintainAspectRatio:!1,scales:{xAxes:[{gridLines:{display:!1},ticks:{min:0,callback:function(e){return $[n]+H(e,0)},fontColor:"black"}}],yAxes:[{gridLines:{display:!0},ticks:{callback:function(e){return"string"===typeof e&&e.length>10?e.substring(0,10)+"\u2026":e}}}]},tooltips:{callbacks:{label:function(e){return $[n]+H(e.xLabel)}}}},legend:null}))),r.a.createElement("div",{className:"dashboard-outer-container"},r.a.createElement("div",{id:"sales-by-product",className:"container right-container"},r.a.createElement("div",{className:"chart-header"},"Sales by Product"),t?r.a.createElement("div",{className:"create-invoice-to-get-started"},r.a.createElement("a",{href:"#new-invoice"},"Create an invoice")," to get started."):r.a.createElement(l.HorizontalBar,{data:{labels:c.products,datasets:[{data:c.sales,label:"Sales Revenue",backgroundColor:"#c3eee7",borderColor:"#66bbae",borderWidth:1}]},options:{maintainAspectRatio:!1,scales:{xAxes:[{gridLines:{display:!1},ticks:{min:0,callback:function(e){return $[n]+H(e,0)},fontColor:"black"}}],yAxes:[{gridLines:{display:!0},ticks:{callback:function(e){return"string"===typeof e&&e.length>10?e.substring(0,10)+"\u2026":e}}}]},tooltips:{callbacks:{label:function(e){return $[n]+H(e.xLabel)}}}},legend:null}))))}}]),n}(a.Component),Xe=(n(569),function(){var e=Object(p.a)(m.a.mark((function e(t,n){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\n    INSERT INTO user (uuid, currency, created_date)\n    VALUES ($uuid, $currency, $created_date)\n    ON CONFLICT(uuid) DO UPDATE SET currency=excluded.currency;\n  ",a={$uuid:t,$currency:n,$created_date:(new Date).toISOString()},e.next=4,window.userbase.execSql({databaseName:"prinvoice_main",sql:"\n    INSERT INTO user (uuid, currency, created_date)\n    VALUES ($uuid, $currency, $created_date)\n    ON CONFLICT(uuid) DO UPDATE SET currency=excluded.currency;\n  ",bindValues:a});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),ze=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;Object(v.a)(this,n),(a=t.call(this,e)).handleInputChange=function(e){a.state.error&&a.setState({error:void 0});var t=e.target,n=t.value,r=t.name;a.setState(Object(g.a)({},r,n))},a.handleChangeCurrency=function(e){a.setState({currency:e.target.value})},a.handleUpdateAccount=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=a.props.user,r=a.state,i=r.username,c=r.currency,!r.loadingUpdateAccount){e.next=5;break}return e.abrupt("return");case 5:return a.setState({loadingUpdateAccount:!0,errorUpdateAccount:void 0}),e.prev=6,e.next=9,Promise.all([n.username!==i&&window.userbase.updateUser({username:i,email:i}),Xe(n.userId,c)]);case 9:a._isMounted&&a.setState({loadingUpdateAccount:!1}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),a._isMounted&&a.setState({loadingUpdateAccount:!1,errorUpdateAccount:e.t0.message});case 15:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}(),a.handleUpdatePassowrd=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=a.state,r=n.currentPassword,i=n.newPassword,!n.loadingUpdatePassword){e.next=4;break}return e.abrupt("return");case 4:return a.setState({loadingUpdatePassword:!0,errorUpdatePassword:void 0}),e.prev=5,e.next=8,window.userbase.updateUser({currentPassword:r,newPassword:i});case 8:a._isMounted&&a.setState({loadingUpdatePassword:!1}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),a._isMounted&&a.setState({loadingUpdatePassword:!1,errorUpdatePassword:e.t0.message});case 14:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}(),a.handleDeleteAccount=function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!window.confirm("Are you sure you want to delete your account?")){e.next=5;break}return e.next=4,window.userbase.deleteUser();case 4:a.props.handleResetState();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var r=a.props,i=r.user,c=r.sqlJsDb,o=i.username,s=i.userId;return a.state={username:o,currency:We(c,s)||"USD",loadingUpdateAccount:!1,errorUpdateAccount:void 0,loadingUpdatePassword:!1,errorUpdatePassword:void 0},a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this.state,t=e.username,n=e.currency,a=e.loadingUpdateAccount,i=e.errorUpdateAccount,c=e.loadingUpdatePassword,o=e.errorUpdatePassword;return r.a.createElement("div",{id:"account-page"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"account-page-section"},r.a.createElement("div",{className:"account-page-header-section"},r.a.createElement("span",{className:"account-page-header"},"Edit account"),r.a.createElement("div",{className:"account-page-header-line"})),r.a.createElement("form",{onSubmit:this.handleUpdateAccount},r.a.createElement("div",{className:"account-page-form-input-section"},r.a.createElement("label",null,"Email"),r.a.createElement("input",{className:"text-input",type:"email",name:"username",autoComplete:"username",onChange:this.handleInputChange,defaultValue:t,placeholder:"Email"})),r.a.createElement("div",{className:"account-page-form-input-section"},r.a.createElement("label",null,"Default currency"),r.a.createElement("select",{id:"account-page-currency-selector",className:"text-input",defaultValue:n,onChange:this.handleChangeCurrency},Object.keys($).map((function(e){return r.a.createElement("option",{value:e,key:e},e)})))),r.a.createElement("input",{className:"button",type:"submit",value:"Update account",disabled:a}),i&&r.a.createElement("div",{className:"error"},i))),r.a.createElement("div",{className:"account-page-section"},r.a.createElement("div",{className:"account-page-header-section"},r.a.createElement("span",{className:"account-page-header"},"Change password"),r.a.createElement("div",{className:"account-page-header-line"})),r.a.createElement("form",{onSubmit:this.handleUpdatePassowrd},r.a.createElement("div",{className:"account-page-form-input-section"},r.a.createElement("label",null,"Current password"),r.a.createElement("input",{className:"text-input",type:"password",name:"currentPassword",autoComplete:"password",onChange:this.handleInputChange,placeholder:"Current password"})),r.a.createElement("div",{style:{marginTop:"1em"},className:"account-page-form-input-section"},r.a.createElement("label",null,"New password"),r.a.createElement("input",{className:"text-input",type:"password",name:"newPassword",autoComplete:"new-password",onChange:this.handleInputChange,placeholder:"New password"})),r.a.createElement("input",{className:"button",type:"submit",value:"Update password",disabled:c}),o&&r.a.createElement("div",{className:"error"},o))),r.a.createElement("div",{className:"account-page-section"},r.a.createElement("div",{className:"account-page-header-section"},r.a.createElement("span",{className:"account-page-header dangerous"},"Danger zone"),r.a.createElement("div",{className:"account-page-header-line"})),r.a.createElement("form",{onSubmit:this.handleDeleteAccount},r.a.createElement("input",{id:"delete-account-button",className:"button",type:"submit",value:"Delete account"})))))}}]),n}(a.Component),Ze=function(e){Object(h.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).loadData=Object(p.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){var t=e.db;return a.setState({sqlJsDb:t})},e.next=3,ke(t);case 3:case"end":return e.stop()}}),e)}))),a.handleSignIn=function(){var e=Object(p.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.loadData();case 2:a.setState({user:t}),window.location.hash="";case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleSetUser=function(e){var t=e.user;a.setState({user:t})},a.handleResetState=function(e){a.setState({lastUsedUsername:e,user:void 0,sqlJsDb:void 0,mode:void 0}),window.location.hash="sign-in"},a.handleUpdateUser=function(e){a.setState({user:e})},a.getDefaultSignedInMode=function(){var e=a.state.sqlJsDb;if(e)return a.setState({mode:Ye(e)?"dashboard":"invoices"})},a.handleReadHash=function(){var e=!!a.state.user,t=window.location.hash.substring(1);switch(t){case"sign-up":case"sign-in":return e?window.location.hash="":a.setState({mode:t});case"dashboard":case"invoices":case"customers":case"new-invoice":case"account":return e?a.setState({mode:t}):window.location.hash="sign-in";default:return e&&""===t?a.getDefaultSignedInMode():window.location.hash=e?"":"sign-in"}},a.handleDownloadData=function(){var e=a.state.sqlJsDb.export(),t="Prinvoice_backup-".concat((new Date).toLocaleDateString(),".db"),n=new File([e],t,{type:"application/vnd.sqlite3"});z(n)},a.handleImportData=function(){!function(e,t){var n=window.document.createElement("input");n.type="file",n.accept=e,n.style.opacity="0",n.onchange=function(e){t(e.target.files[0]),document.body.removeChild(n)},document.body.appendChild(n),n.click()}(navigator.userAgent.match("CriOS")?"":".db",a.handleImportedFile)},a.handleImportedFile=function(){var e=Object(p.a)(m.a.mark((function e(t){var n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.restoringFromBackupFile,i=n.user,!r){e.next=3;break}return e.abrupt("return");case 3:return a.setState({restoringFromBackupFile:!0}),e.prev=4,e.next=7,Le(t,i.userId);case 7:a.setState({restoringFromBackupFile:!1}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(4),window.alert("Failed to restore from backup: ".concat(e.t0.message)),a.setState({restoringFromBackupFile:!1});case 14:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t){return e.apply(this,arguments)}}(),a.state={mode:void 0,user:void 0,lastUsedUsername:void 0,sqlJsDb:void 0},a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){var e=Object(p.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener("hashchange",this.handleReadHash,!1),e.prev=1,e.next=4,window.userbase.init({appId:"0a95df12-c854-4043-abc8-653e19a9a6b6",updateUserHandler:this.handleSetUser});case 4:if(!(t=e.sent).user){e.next=8;break}return e.next=8,this.loadData();case 8:this.setState(Object(u.a)({},t)),e.next=23;break;case 11:return e.prev=11,e.t0=e.catch(1),e.prev=13,e.next=16,window.userbase.signOut();case 16:e.next=20;break;case 18:e.prev=18,e.t1=e.catch(13);case 20:localStorage.clear(),console.error(e.t0),window.alert("Oops! Something went wrong. Please refresh the page.\n\nIf the issue persists, please contact support@prinvoice.com.");case 23:this.handleReadHash();case 24:case"end":return e.stop()}}),e,this,[[1,11],[13,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.user,a=t.lastUsedUsername,i=t.sqlJsDb,c=t.mode,o=void 0===c;return r.a.createElement("div",null,o&&r.a.createElement("div",{className:"centered",style:{top:"40%",width:"40%"}},r.a.createElement("div",{className:"loader"})),n&&"new-invoice"!==c&&r.a.createElement(T,{key:"NavBar"+c,mode:c,user:n,handleDownloadData:this.handleDownloadData,handleImportData:this.handleImportData,handleResetState:this.handleResetState}),c&&function(){switch(c){case"sign-up":case"sign-in":return r.a.createElement(N,{key:"UserForm"+c,mode:c,lastUsedUsername:"sign-in"===c?a:"",handleSignIn:e.handleSignIn});case"new-invoice":return r.a.createElement(Ce,{user:n,sqlJsDb:i});case"invoices":return r.a.createElement(Be,{key:Math.random(),user:n,sqlJsDb:i});case"customers":return r.a.createElement(qe,{key:Math.random(),user:n,sqlJsDb:i});case"account":return r.a.createElement(ze,{user:n,sqlJsDb:i,handleResetState:e.handleResetState});case"dashboard":default:return r.a.createElement(Ke,{key:Math.random(),user:n,sqlJsDb:i})}}())}}]),n}(a.Component);s.a.set({DECIMAL_PLACES:10,ROUNDING_MODE:6}),l.defaults.global.defaultFontFamily="Barlow",c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ze,null)),document.getElementById("root"))}},[[285,1,2]]]);
//# sourceMappingURL=main.077f52cb.chunk.js.map